<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/screen/window.xsd"
        xmlns:c="http://schemas.haulmont.com/cuba/screen/jpql_condition.xsd"
        caption="msg://openPositionMasterBrowse.caption"
        focusComponent="openPositionsTable"
        messagesPack="com.company.itpearls.web.screens.openposition">
    <data readOnly="true">
        <collection id="openPositionsDc"
                    class="com.company.itpearls.entity.Position">
            <view extends="_minimal">
                <property name="positionRuName"/>
            </view>
            <loader id="openPositionsDl">
                <query>
                    <![CDATA[select e from itpearls_Position e
                            where e in
                            (select g.positionType
                                from itpearls_OpenPosition g
                                where not g.openClose = true)
                            order by e.positionRuName]]>
                    <condition>
                        <and>
                            <c:jpql>
                                <c:where>e in
                                    (select g.positionType
                                        from itpearls_OpenPosition g
                                        where g.priority = :priorityfield
                                            and g.commandCandidate = 0)
                                </c:where>
                            </c:jpql>
                        </and>
                    </condition>
                </query>
            </loader>
        </collection>
        <collection id="companyDc"
                    class="com.company.itpearls.entity.Company">
            <view extends="company-view"/>
            <loader id="companyDl">
                <query>
                    <![CDATA[select e from itpearls_Company e
                            order by e.comanyName]]>
                    <condition>
                        <and>
                            <c:jpql>
                                <c:where>e in
                                    (select f.companyName
                                        from itpearls_CompanyDepartament f
                                        where f in
                                            (select g.projectDepartment
                                                from itpearls_Project g
                                                where g in
                                                    (select i.projectName
                                                        from itpearls_OpenPosition i
                                                        where (not i.openClose = true)
                                                            and i.positionType = :posTypeCompany)))
                                </c:where>
                            </c:jpql>
                        </and>
                    </condition>
                </query>
            </loader>
        </collection>
        <collection id="projectNamcDc"
                    class="com.company.itpearls.entity.Project">
            <view extends="_minimal">
                <property name="projectName"/>
            </view>
            <loader id="projectNameDl">
                <query>
                    <![CDATA[select e from itpearls_Project e
                                order by e.projectName]]>
                    <condition>
                        <and>
                            <c:jpql>
                                <c:where>e in
                                    (select f.projectName
                                        from itpearls_OpenPosition f
                                        where f.positionType = :posType
                                            and (not f.openClose = true))
                                </c:where>
                            </c:jpql>
                        </and>
                    </condition>
                </query>
            </loader>
        </collection>
        <collection id="vacansyNameDc"
                    class="com.company.itpearls.entity.OpenPosition">
            <view extends="_minimal">
                <property name="vacansyName"/>
            </view>
            <loader id="vacansyNameDl">
                <query>
                    <![CDATA[select x from itpearls_OpenPosition x
                                where (not x.openClose = true)
                                order by x.vacansyName]]>
                    <condition>
                        <and>
                            <c:jpql>
                                <c:where>x.positionType in
                                    (select f.positionType
                                        from itpearls_OpenPosition f
                                        where f.positionType = :posTypeVacancy
                                            and (not f.openClose = true))
                                </c:where>
                            </c:jpql>
                            <c:jpql>
                                <c:where>x.priority = :priorityfield</c:where>
                            </c:jpql>
                        </and>
                    </condition>
                </query>
            </loader>
        </collection>
    </data>
    <dialogMode height="800"
                width="600"/>
    <layout expand="mainHBox"
            spacing="true">
        <groupBox height="100%"
                  stylename="borderless">
            <textField id="headerTextField"
                       caption="msg://msgHeaderOfWizard"
                       stylename="h3"/>
        </groupBox>
        <hbox id="mainHBox"
              width="100%"
              height="100%"
              expand="openPositionTableVBox"
              spacing="true">
            <vbox id="openPositionTableVBox"
                  spacing="true"
                  width="100%"
                  box.expandRatio="2"
                  align="TOP_LEFT"
                  expand="openPositionsTable"
                  height="100%">
                <lookupField id="notLowerRatingLookupField"
                             align="MIDDLE_RIGHT"
                             width="100%"
                             caption="msg://msgPriorityPosition"
                             description="msg://msgStatusNotLower"/>
                <dataGrid id="openPositionsTable"
                          width="100%"
                          height="100%" editorEnabled="false"
                          contextMenuEnabled="false"
                          dataContainer="openPositionsDc">
                    <actions>
                    </actions>
                    <columns>
                        <column property="positionRuName"
                                id="positionRuName"/>
                    </columns>
                    <buttonsPanel id="buttonsPanel"
                                  alwaysVisible="true">
                    </buttonsPanel>
                </dataGrid>
                <hbox>
                    <textField id="minSalaryField"
                               caption="msg://msgMinSalary"
                               stylename="borderless"/>
                    <textField id="maxSalaryField"
                               caption="msg://msgMaxSalary"
                               stylename="borderless"/>
                </hbox>
            </vbox>
            <vbox spacing="true"
                  width="100%"
                  height="100%"
                  box.expandRatio="6">
                <hbox spacing="true"
                      width="100%"
                      height="100%">
                    <dataGrid id="companyTable"
                              width="100%"
                              editorEnabled="false"
                              contextMenuEnabled="false"
                              dataContainer="companyDc"
                              height="100%">
                        <actions>
                        </actions>
                        <columns>
                            <column id="comanyName"
                                    property="comanyName"/>
                        </columns>
                    </dataGrid>
                    <richTextArea id="companyInfoRichTextArea"
                                  width="100%"
                                  editable="false"
                                  height="100%"/>
                </hbox>
                <hbox spacing="true" width="100%" height="100%">
                    <dataGrid id="projectNameTable"
                              width="100%"
                              editorEnabled="false"
                              contextMenuEnabled="false"
                              height="100%"
                              dataContainer="projectNamcDc">
                        <columns>
                            <column id="projectName"
                                    property="projectName"/>
                        </columns>
                    </dataGrid>
                    <richTextArea id="projectInfoRichTextArea"
                                  width="100%"
                                  editable="false"
                                  height="100%"/>
                </hbox>
                <hbox spacing="true" width="100%" height="100%">
                    <dataGrid id="vacansyNameTable"
                              width="100%"
                              editorEnabled="false"
                              contextMenuEnabled="false"
                              height="100%"
                              dataContainer="vacansyNameDc">
                        <columns>
                            <column id="priorityColumn"
                                    width="60px"
                                    caption="msg://msgPriority">
                                <iconRenderer/>
                            </column>
                            <column id="vacansyName"
                                    property="vacansyName"
                                    width="450px"/>
                        </columns>
                    </dataGrid>
                    <vbox width="100%"
                          height="100%"
                          expand="vacansyInfoRictTextArea">
                        <richTextArea id="vacansyInfoRictTextArea"
                                      width="100%"
                                      editable="false"
                                      height="100%"/>
                        <hbox width="100%">
                            <hbox>
                                <label value="msg://msgMinSalary"
                                       stylename="large"/>
                                <label id="minSalaryVacancyField"
                                       dataContainer="vacansyNameDc"
                                       property="salaryMin"
                                       width="100%"
                                       stylename="large"/>
                            </hbox>
                            <hbox>
                                <label value="msg://msgMaxSalary"
                                       stylename="large"/>
                                <label id="maxSalaryVacancyField"
                                       dataContainer="vacansyNameDc"
                                       property="salaryMax"
                                       width="100%"
                                       stylename="large"/>
                            </hbox>
                        </hbox>
                    </vbox>
                </hbox>
            </vbox>
            <vbox spacing="true">
            </vbox>
        </hbox>
        <hbox id="lookupActions"
              spacing="true"
              visible="false">
            <button action="lookupSelectAction"/>
            <button action="lookupCancelAction"/>
        </hbox>
    </layout>
</window>
